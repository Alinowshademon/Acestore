<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‚àÜCE Store | Online Shopping</title>
<style>
  body { margin:0; font-family:Arial, sans-serif; background:#f8f8f8; }
  header { background:#111; color:#fff; padding:18px 12px; text-align:center; }
  header h1 { margin:0; font-size:1.6rem; letter-spacing:2px; }
  nav { margin-top:8px; }
  nav a { color:white; margin:0 10px; text-decoration:none; font-weight:600; cursor:pointer; }
  .container { max-width:1100px; margin:20px auto; padding:12px; }
  .products { display:grid; gap:18px; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); }
  .product { background:#fff; padding:14px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.08); text-align:center; }
  .product img{ max-width:100%; border-radius:8px; height:200px; object-fit:cover; }
  .price{ font-size:1.05rem; color:#333; margin:10px 0; }
  .btn{ background:#111; color:#fff; padding:10px 14px; border:none; border-radius:6px; cursor:pointer; }
  .btn:disabled{ opacity:0.6; cursor:not-allowed; }
  footer{ background:#111; color:#fff; text-align:center; padding:14px; margin-top:28px; }

  #cart, #confirmed-orders { display:none; background:#fff; padding:16px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.06); }
  table{ width:100%; border-collapse:collapse; margin-bottom:12px; }
  th,td{ padding:8px; text-align:center; border-bottom:1px solid #eee; }
  .remove-btn{ background:#e53935; color:#fff; border:none; padding:6px 8px; border-radius:6px; cursor:pointer; }

  #checkout-modal { display:none; position:fixed; left:0; right:0; top:0; bottom:0; background:rgba(0,0,0,0.45); align-items:center; justify-content:center; }
  #checkout-modal .modal { background:#fff; width:360px; max-width:94%; padding:16px; border-radius:10px; box-shadow:0 6px 20px rgba(0,0,0,0.3); }
  .modal label{ display:block; margin:8px 0 6px; font-weight:600; font-size:0.9rem; }
  .modal input{ width:100%; padding:8px 10px; border-radius:6px; border:1px solid #ddd; }
  .modal .actions{ display:flex; gap:8px; margin-top:12px; justify-content:flex-end; }
  .small-note{ font-size:0.85rem; color:#555; margin-top:8px; }
  @media (max-width:520px){ .product img{ height:160px } }
</style>
</head>
<body>
<header>
  <h1>‚àÜCE Store</h1>
  <nav>
    <a onclick="showShop()">Shop</a>
    <a onclick="showCart()">üõí Cart (<span id="cart-count">0</span>)</a>
    <a onclick="showConfirmedOrders()">Confirmed Orders</a>
  </nav>
</header>

<div class="container" id="shop">
  <h2>Featured Products</h2>
  <div class="products" id="products-list"></div>
</div>

<div class="container" id="cart">
  <h2>Your Cart</h2>
  <table>
    <thead><tr><th>Product</th><th>Price</th><th>Action</th></tr></thead>
    <tbody id="cart-items"></tbody>
  </table>
  <h3>Total: <span id="cart-total">‡ß≥0.00</span></h3>
  <div style="display:flex;gap:8px">
    <button class="btn" onclick="showShop()">Continue Shopping</button>
    <button class="btn" id="btn-checkout" onclick="openCheckoutModal()">Checkout & Pay</button>
  </div>
  <p class="small-note" id="order-status">Order Status: <span>No orders yet</span></p>
</div>

<div class="container" id="confirmed-orders">
  <h2>Confirmed Orders</h2>
  <p>Recent Confirmed Orders(update manually):</p>
  <ul id="confirmed-list">
    <li> October 4, 2025 </li>
    <li> Name :- Emon 
      Phone :- 0197XXXX882
    Order :- Stylish Jacket -1500 taka
    Time :- 03:55</li>
      <li>Oct 3, 2025</li>
      <li>===========</li>
      <li>018XXXXX699</li>
      <li>019XXXXX882</li>
      <li>018XXXXX176</li>
      <li>018XXXXX656</li>
  </ul>
  <p class="small-note">After verifying TRX in bKash, add it here or update via backend.</p>
</div>

<footer>
  <p>¬© 2025 ‚àÜCE Store Online Shopping | All Rights Reserved</p>
</footer>

<div id="checkout-modal">
  <div class="modal">
    <h3>Confirm Order & Payment</h3>
    <label for="cust-name">Your name</label>
    <input id="cust-name" placeholder="Full name (optional)" />
    <label for="cust-phone">Phone</label>
    <input id="cust-phone" placeholder="Phone (optional)" />
    <div class="actions">
      <button class="btn" onclick="closeCheckoutModal()">Cancel</button>
      <button class="btn" id="confirm-pay-btn" onclick="confirmAndCreateOrder()">Confirm & Pay</button>
    </div>
    <p class="small-note">You will be redirected to a Google Form to submit your TRX ID.</p>
  </div>
</div>

<script>
const SERVERLESS_URL = "https://Acestoreurl.netlify.app/.netlify/functions/create-order";
const GOOGLE_FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLScTSThg_jtbqCnmKreArJEc4fiPVwZqSxEz3ukwLaBj9Xduhg/viewform?usp=pp_url";
const FORM_ENTRY_ORDER = "entry.472617341";
const FORM_ENTRY_TOTAL = "entry.1689651769";
const FORM_ENTRY_NAME  = "entry.1026182999";
const FORM_ENTRY_PHONE = "entry.176908676";

const PRODUCTS = [
  { id: "jacket", name: "Stylish Jacket", price: 1500, img: "https://m.media-amazon.com/images/I/51oWgroI5PL._UY1000_.jpg" },
  { id: "sneakers", name: "Cool Sneakers", price: 1200, img: "https://i.pinimg.com/736x/51/12/96/511296d23d9358a154a4872e25289917.jpg" },
  { id: "watch", name: "Classic Watch", price: 600, img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRWBKhuYEPwT7QuCwlYnU_y1BeShsLx675Zts8p__Gfv06Y9GhB4lswSL4J&s=10" },
];

let cart = [];

function renderProducts(){
  const container = document.getElementById("products-list");
  container.innerHTML = "";
  PRODUCTS.forEach(p => {
    const el = document.createElement("div");
    el.className = "product";
    el.innerHTML = `
      <img src="${p.img}" alt="${p.name}">
      <h3>${p.name}</h3>
      <div class="price">‡ß≥${p.price}</div>
      <button class="btn" onclick="addToCart('${p.name}', ${p.price})">Add to Cart</button>
    `;
    container.appendChild(el);
  });
}
renderProducts();

function addToCart(name, price){
  cart.push({ name, price });
  updateCart();
}

function updateCart(){
  document.getElementById("cart-count").textContent = cart.length;
  const tbody = document.getElementById("cart-items");
  tbody.innerHTML = "";
  let total = 0;
  cart.forEach((item, i) => {
    total += item.price;
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${item.name}</td><td>‡ß≥${item.price.toFixed(2)}</td>
      <td><button class="remove-btn" onclick="removeItem(${i})">Remove</button></td>`;
    tbody.appendChild(tr);
  });
  document.getElementById("cart-total").textContent = "‡ß≥" + total.toFixed(2);
}

function removeItem(i){ cart.splice(i,1); updateCart(); }

function showShop(){ hideAllSections(); document.getElementById("shop").style.display="block"; }
function showCart(){ hideAllSections(); document.getElementById("cart").style.display="block"; }
function showConfirmedOrders(){ hideAllSections(); document.getElementById("confirmed-orders").style.display="block"; }
function hideAllSections(){
  document.getElementById("shop").style.display="none";
  document.getElementById("cart").style.display="none";
  document.getElementById("confirmed-orders").style.display="none";
}

function openCheckoutModal(){ if(cart.length===0) return; document.getElementById("checkout-modal").style.display = "flex"; }
function closeCheckoutModal(){ document.getElementById("checkout-modal").style.display = "none"; }

async function confirmAndCreateOrder() {
  const name = document.getElementById("cust-name").value.trim();
  const phone = document.getElementById("cust-phone").value.trim();
  const total = cart.reduce((s, i) => s + i.price, 0);
  const orderDetails = cart.map(it => `${it.name} - ‡ß≥${it.price.toFixed(2)}`).join(", ");

  const prefillUrl = buildPrefilledFormUrl(orderDetails, total, name, phone);
  // ‚úÖ open Google Form immediately (so it won't get blocked)
  window.open(prefillUrl, "_blank");

  document.getElementById("order-status").textContent = "Submitting order to GitHub (secure)...";
  const btn = document.getElementById("confirm-pay-btn");
  btn.disabled = true;

  const payload = {
    customerName: name || "Guest",
    customerContact: phone || "",
    orderDetails,
    total,
    timestamp: new Date().toISOString(),
    prefillFormUrl: prefillUrl
  };

  try {
    const res = await fetch(SERVERLESS_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    if (!res.ok) throw new Error(await res.text());

    document.getElementById("order-status").textContent =
      "‚úÖ Order recorded. Complete payment and submit TRX in the form.";
    cart = [];
    updateCart();
    closeCheckoutModal();
  } catch (e) {
    document.getElementById("order-status").textContent = "‚ùå Error: " + e.message;
  } finally {
    btn.disabled = false;
  }
}

function buildPrefilledFormUrl(orderDetails, total, name, phone) {
  const params = new URLSearchParams();
  if (FORM_ENTRY_ORDER) params.append(FORM_ENTRY_ORDER, orderDetails);
  if (FORM_ENTRY_TOTAL) params.append(FORM_ENTRY_TOTAL, total.toFixed(2));
  if (FORM_ENTRY_NAME) params.append(FORM_ENTRY_NAME, name);
  if (FORM_ENTRY_PHONE) params.append(FORM_ENTRY_PHONE, phone);
  return GOOGLE_FORM_URL + "&" + params.toString();
}

showShop();
updateCart();
</script>
</body>
  </html>
